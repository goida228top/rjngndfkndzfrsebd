#include "Globals.h"
#include <WebServer.h>

// --- НАСТРОЙКИ ---
const int SAMPLE_RATE = 16000; // Увеличиваем качество для лучшего распознавания
const int RECORD_BUFFER_SIZE = 85000; // Немного увеличим буфер (~2.6 сек при 16кГц 16бит, либо ~5 сек при 8кГц)
// Примечание: При 16кГц буфер заполнится быстрее. Для длинных фраз лучше говорить быстро.

// --- ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ ---

// Состояние системы
Mode menuMode;
int selectedItem = 0;
bool isFirstRecording = true;
unsigned long stealth_clock_exit_time = 0;

// Буферы записи
uint8_t* rec_data = nullptr;
size_t recorded_bytes = 0;
uint8_t* last_rec_data = nullptr;
size_t last_recorded_bytes = 0;

// Состояние сообщений
String receivedMessage = "";
// НОВАЯ ПЕРЕМЕННАЯ: Хранит последний УСПЕШНЫЙ ответ от ИИ для контекста
String lastValidGeminiContext = "Привет! Я твой ассистент."; 

bool newMessageReceived = false;
unsigned long messageTimestamp = 0;
int currentPage = 0;
int totalPages = 0;

// Состояние UI
int messageMenuSelection = 0;
String diagStatusGoogle = (const char*)u8"Ожидание...";
String diagStatusServer = (const char*)u8"Ожидание...";
bool isClockDarkTheme = false;
int clockRotation = 1;

// Пагинация
String pages[MAX_PAGES];

// Сеть
Preferences preferences;
WebServer server(80);

void setMenuMode(Mode newMode) {
    menuMode = newMode;
}